# Bead_Tracker
## Introduction
The app Bead_Tracker tracks and measures the position of a single bead held by optical tweezers. The software also can be used to track the rotational movement (gyration) of the bead around the optical trap, especially exploiting the bacteria-on-a-bead system.
All measurements are given as _pixel units_. Using the pixel-micron conversion factor of the micrscoscope setup, it possible to analyse the bead displacement in the movies as well as forces generated when bead is pulled outside the optical trap.

Example of tracked bead | GUI of the app
----------------------- | --------------
<img align="center" src="../main_version/Movie_and_Images/Movie_Overlay.gif" width="80%"> | <img align="center" src="../main_version/Movie_and_Images/img_GUI.png" width="90%"> 

<br/><br/> 

## Working Modes
There are two working modes for the app, that can be chosen with the central switch-button in the GUI
### BeadTrack
This function tracks the center of the bead. As output gata is saved as .txt file labeled TC-Track.txt, which is organized as follow:
Frame |	X_1 |	Y_1 |	nX_1 |	nY_1 |	Disp |	Ori_Disp |	Radius_1 
----- | --- | --- | ---- | ----- | ----- | --------- | ---------
1.000000 | 98.598571 | 91.951804 | 0.000000 | 0.000000 | 0.000000 | 0.000000 | 20.030492	
2.000000 | 98.389843 | 91.537679 | -0.208728 | -0.414125 | 0.463754 | 0.463754 | 20.046528
... | ... | ... | ... | ... | ... | ... | ... 

The columns values are all in _**pixel**_:
  - *Frame* - frame numbers of each row measurment
  - *X_1* and *Y_1* - the absolute X and Y positions of the bead center (all other columns are calculated using these as raw data)
  - *n_X-1* and *n_X2* - the relative X and Y positions of the bead center, normalized to the first frame position
  - *Disp* - displacement of the bead from previous frame
  - *Ori_Disp* - displacement of the bead from the ORIgin, which is the position of the bead in the first frame
  - *Radius_1* - Radius of the circle fitted around the detected bead

### Gyration
This function measures the rotational movement of the bead, exploiting the bacteria hanging outside the bacteria-on-a-bead system. After starting this analysis mode, the app display the first frame of the movie. The user than draw a circle larger than the bead and that cross where the bacterial body is roughly positioned. The intensity value of each pixel below the drawn circle will be measured and stored in two files.

Bead under optical trap |	Circle for tracking Gyration  
----------------------- | ---------------------------- 
![Movie of a Bead under optical trap](../main_version/Movie_and_Images/Movie_Bead.gif) | ![GUI of the app](../main_version/Movie_and_Images/img_Set_Gyration.png)

The output files from the Gyration analysis are:
  * *BoaB_perim_Circle.txt* - each row is the pixel intensity value below the circle perimeter at each frame. Each columns is the same pixel position across all time points. Rows are ordered sequentially from first to last frame.
  * *BoaB_vertex_Circle.txt* - it a subset dataset of BoaB_perim_Circle, gathering only 20 equally spaced points of the drawn circle.

## Result examples
Automatic generated output (Preview End_plot) showing the R^2 displacement (Ori_Disp) and the Bead radius, using _TC-Track.txt_ file. Knowing the stiffness of the optical trap, the R^2 displacement can be used to calculate the force generated by shift of the beads outside the optical trap.

![Plot of R^2 and Radius](../main_version/Movie_and_Images/img_Plot_Displacement_Position.png)

Plotting pixel intensity value of one position along the drawn circle. This plots shows a periodic spikes, which signal the passage of the cell in that position at different time points. This can be used to estimate speed and duration of gyration of the bead.

![Img - Setting the cicle to measure gyration](../main_version/Movie_and_Images/img_Plot_Gyration.png)


## Data Input
Provide a folder with a stack of .tiff images, which are the sequential frames of the movie. Note: ideally .tiff images should be in the form PREFIX_xyz.tif, where PREFIX is a any name, and xyz a number of N digit. The latter represent frame number and ordering the the images (i.e. labeling using 4 digit numbers, number will be in form 0001 to 9999).


## Options and Parameters
Display options, to aid in following if the process is done correctly and plotting the results:
* *Display Bead Fitting*
* *Display Masks*
* *show inner fitting*
* *show outer fitting*
* *show search area*
* *Preview End_plot*

Parameters for analysis
* *T. Levels* - use N levels to perform a multilevel image thresholds, using Otsuâ€™s method (value of 2 is usually sufficient)
* *Inner C* - create the inner circle by scaling radius of detected bead of a factor X (<=1) 
* *Outer C* - create the inner circle by scaling radius of detected bead of a factor X (>=1) 
* *Range* - Default is S:E, to perfrom analysis from start to end frame. Replace S and E to set a different range.


## Method
To identify a bead the app uses multilevel image thresholds to find potential objects. The masks of those obejects are filtered to find the potential bead. On first frame, it will take the largest "circular" object near the center, which most likely is the trapped bead; on all following frames it will take the closest best match (by area, shape and position). The bead is then fitted to a circle and will be tracked as proxy of the bead. There is also the option to use a pseudo-Gaussian method (option: Method 2), by creating two circle that encompass the bright difraction "ring" that appears around the bead. The highest pixel value found in the area between the two circles are used to fit in a circle. 

